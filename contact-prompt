#!/usr/bin/env bash

vcf=~/.contacts.vcf 

deps="rofi xclip"

for d in $deps
do
    if ! which $d 
    then
        if uname | grep --quiet "Linux"
        then
            notify-send "Please install $d"
            exit 1
        else
            echo "Please install $d"
            exit 1
        fi
    fi
done

shopt -s nullglob globstar

typeit=0
if [[ $1 == "--type" ]]; then
    typeit=1
    shift
fi
contact=$(grep "FN" $vcf | cut -d":" -f2- | sed '/^\s*$/d' | rofi -dmenu -p "contact: ")

if [[ $typeit -eq 0 ]]; then
    grep -i -A 20 "$contact" $vcf \
        | grep '\(([0-9]\{3\})\|[0-9]\{3\}\)[ -]\?[0-9]\{3\}[ -]\?[0-9]\{4\}' \
        | head -1 \
        | cut -d":" -f2- \
        | tr -d '\r' \
        | tr -d '\n' \
        | xclip -sel clip
else
    exit
fi
